"""–¢–µ—Å—Ç—ã –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from bot.character import Character


def test_character_basic():
    """–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
    alice = Character()
    
    print(f"=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ {alice.name} ===\n")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
    test_cases = [
        ("–ü—Ä–∏–≤–µ—Ç!", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
        ("–°–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å"), 
        ("–ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ", "–ø–æ–¥–¥–µ—Ä–∂–∫–∞"),
        ("–ü–æ–∫–∞!", "–ø—Ä–æ—â–∞–Ω–∏–µ"),
        ("–ö–∞–∫ –¥–µ–ª–∞?", "–æ–±—â–µ–Ω–∏–µ")
    ]
    
    print("–¢–µ—Å—Ç—ã —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:")
    print("-" * 40)
    
    for i, (message, expected_type) in enumerate(test_cases, 1):
        response = alice.get_template_response(message, "–¢–µ—Å—Ç–µ—Ä")
        print(f"{i}. –°–æ–æ–±—â–µ–Ω–∏–µ: {message}")
        print(f"   –û—Ç–≤–µ—Ç: {response}")
        print(f"   –û–∂–∏–¥–∞–µ–º—ã–π —Ç–∏–ø: {expected_type}")
        print()
    
    # –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
    print("=== –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç ===")
    prompt = alice.get_system_prompt("–¢–µ—Å—Ç–µ—Ä")
    print(f"–î–ª–∏–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞: {len(prompt)} —Å–∏–º–≤–æ–ª–æ–≤")
    print("–°–æ–¥–µ—Ä–∂–∏—Ç '—Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ':", "—Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ" in prompt)
    print("–°–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:", alice.name in prompt)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    print("\n=== –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===")
    print(f"–°–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å: {alice.get_random_question()}")
    print(f"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: {alice.get_info()[:100]}...")


def test_edge_cases():
    """–¢–µ—Å—Ç—ã –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤."""
    alice = Character()
    
    print("\n=== –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ ===")
    
    edge_cases = [
        "",  # –ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        "–ü–†–ò–í–ï–¢!!!",  # –ö–∞–ø—Å
        "–ø—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞ —Å–ø–∞—Å–∏–±–æ",  # –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        "Hello world",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
        "123456",  # –¶–∏—Ñ—Ä—ã
        "üòäüòäüòä"  # –¢–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏
    ]
    
    for message in edge_cases:
        response = alice.get_template_response(message)
        print(f"'{message}' -> '{response[:50]}...'")


if __name__ == "__main__":
    test_character_basic()
    test_edge_cases()
    print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø—Ä–æ–π–¥–µ–Ω—ã!")